{"version":3,"sources":["../../../src/backend/base/index.ts"],"names":["generateConfig","config","projectId","projectToken","res","locals","KOJI_PROJECT_ID","KOJI_PROJECT_TOKEN","Error","Base"],"mappings":";;;;;;;;;;;;;;AAEA;AACA;AACA;;AAUA;AACA;AACA;;AAQA;AACA;AACA;AACA;AACA;AACO,SAASA,cAAT,CAAwBC,MAAxB,EAAiF;AACtF,MAAIC,SAAJ;AACA,MAAIC,YAAJ,CAFsF,CAItF;AACA;;AACA,MAAIF,MAAM,CAACG,GAAX,EAAgB;AAAA,eACsDH,MAAM,CAACG,GAAP,CAAWC,MAAX,IAAqB,EAD3E;;AACMH,IAAAA,SADN,QACXI,eADW;AACqCH,IAAAA,YADrC,QACiBI,kBADjB;;AAEd,QAAI,CAACL,SAAD,IAAc,CAACC,YAAnB,EAAiC;AAC/B,YAAM,IAAIK,KAAJ,CACJ,mHADI,CAAN;AAGD;AACF,GAbqF,CAetF;AACA;;;AACAN,EAAAA,SAAS,GAAGD,MAAM,CAACC,SAAP,IAAoBA,SAAhC;AACAC,EAAAA,YAAY,GAAGF,MAAM,CAACE,YAAP,IAAuBA,YAAtC;AAEA,MAAI,CAACD,SAAD,IAAc,CAACC,YAAnB,EAAiC,MAAM,IAAIK,KAAJ,CAAU,gCAAV,CAAN;AAEjC,SAAO;AACLN,IAAAA,SAAS,EAATA,SADK;AAELC,IAAAA,YAAY,EAAZA;AAFK,GAAP;AAID;;IAEYM,I,GAIX,cAAYR,MAAZ,EAA+C;AAAA;AAAA;AAAA;;AAAA,wBACTD,cAAc,CAACC,MAAD,CADL;AAAA,MACrCC,SADqC,mBACrCA,SADqC;AAAA,MAC1BC,YAD0B,mBAC1BA,YAD0B;;AAG7C,OAAKD,SAAL,GAAiBA,SAAjB;AACA,OAAKC,YAAL,GAAoBA,YAApB;AACD,C","sourcesContent":["import { Response } from 'express';\n\n/**\n * Configuration information for the Koji.\n */\nexport interface BackendConfigurationInput {\n  /** Unique identifier for the Koji. Will override data passed through `res`. */\n  projectId?: string;\n  /** Secret key for the Koji. Will override data passed through `res`. */\n  projectToken?: string;\n  /** Express response object. Used in conjunction with middleware to scope environment variables for instant remixes of the original Koji. For the original definition see [[https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/express/index.d.ts#L127 | @types/express]] */\n  res?: Response;\n}\n\n/**\n * Environment variables that serve as access credentials for the Koji's backend services.\n */\nexport interface BackendConfiguration {\n  /** Unique identifier for the Koji. */\n  projectId: string;\n  /** Secret key for the Koji. */\n  projectToken: string;\n}\n\n/**\n * Generates an extensible configuration for the Koji's backend services.\n *\n * @param config Configuration information for the Koji.\n */\nexport function generateConfig(config: BackendConfigurationInput): BackendConfiguration {\n  let projectId;\n  let projectToken;\n\n  // If the user is passing a response from express, we expect the project details to be written\n  // to res.locals by the middleware.\n  if (config.res) {\n    ({ KOJI_PROJECT_ID: projectId, KOJI_PROJECT_TOKEN: projectToken } = config.res.locals || {});\n    if (!projectId || !projectToken) {\n      throw new Error(\n        'The res.locals object is missing your project information. Have you implemented KojiBackend.middleware correctly?',\n      );\n    }\n  }\n\n  // If the user is explicitly passing a projectId or projectToken, these values should override\n  // other implementations\n  projectId = config.projectId || projectId;\n  projectToken = config.projectToken || projectToken;\n\n  if (!projectId || !projectToken) throw new Error('Unable to find project details');\n\n  return {\n    projectId,\n    projectToken,\n  };\n}\n\nexport class Base {\n  protected projectId: string;\n  protected projectToken: string;\n\n  constructor(config: BackendConfigurationInput) {\n    const { projectId, projectToken } = generateConfig(config);\n\n    this.projectId = projectId;\n    this.projectToken = projectToken;\n  }\n}\n\nexport interface IDatabase extends Base {}\n"],"file":"index.js"}